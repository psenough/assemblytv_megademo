kaaalt = {
{159,32,135,58,135,26,0},
{135,58,159,53,153,58,0},
{153,26,159,32,135,26,0},
{158,29,153,26,156,27,0},
{159,53,135,58,159,32,0},
{156,58,159,53,158,56,0},
{156,58,153,58,159,53,0},
{159,32,153,26,158,29,0},
{78,32,79,29,81,27,0},
{78,32,81,27,84,26,0},
{78,58,78,32,86,45,0},
{86,45,86,58,78,58,0},
{78,32,84,26,86,45,0},
{84,26,96,45,86,45,0},
{103,32,97,26,100,27,0},
{103,32,100,27,102,29,0},
{96,58,96,45,103,58,0},
{103,32,103,58,96,45,0},
{96,45,97,26,103,32,0},
{97,26,96,45,84,26,0},
{39,32,39,29,45,26,0},
{41,27,45,26,39,29,0},
{62,32,39,53,39,32,0},
{39,56,39,53,41,58,0},
{45,58,41,58,39,53,0},
{45,58,39,53,62,53,0},
{39,32,45,26,56,26,0},
{56,26,60,27,61,29,0},
{61,29,62,32,56,26,0},
{62,53,39,53,62,32,0},
{60,58,56,58,62,53,0},
{62,53,61,56,60,58,0},
{45,58,62,53,56,58,0},
{62,32,39,32,56,26,0},
{46,35,46,35,47,34,12},
{47,34,47,34,46,35,12},
{55,35,46,49,46,35,12},
{46,50,46,49,47,50,12},
{47,50,47,50,46,50,12},
{47,50,46,49,55,49,12},
{46,35,47,34,53,34,12},
{53,34,54,34,55,35,12},
{55,35,55,35,53,34,12},
{55,35,55,49,46,49,12},
{54,50,53,50,55,50,12},
{55,49,55,50,53,50,12},
{47,50,55,49,53,50,12},
{46,35,53,34,55,35,12},
{24,32,1,58,1,26,0},
{1,58,24,53,18,58,0},
{18,26,24,32,1,26,0},
{23,29,18,26,22,27,0},
{24,53,1,58,24,32,0},
{22,58,24,53,23,56,0},
{22,58,18,58,24,53,0},
{24,32,18,26,23,29,0},
{-55,32,-54,29,-52,27,0},
{-55,32,-52,27,-49,26,0},
{-55,58,-55,32,-48,45,0},
{-48,45,-48,58,-55,58,0},
{-55,32,-49,26,-48,45,0},
{-49,26,-38,45,-48,45,0},
{-31,32,-37,26,-33,27,0},
{-31,32,-33,27,-31,29,0},
{-38,58,-38,45,-31,58,0},
{-31,32,-31,58,-38,45,0},
{-38,45,-37,26,-31,32,0},
{-37,26,-38,45,-49,26,0},
{43,-19,44,-24,47,-27,0},
{43,-19,47,-27,52,-28,0},
{43,21,43,-19,54,1,0},
{54,1,54,21,43,21,0},
{43,-19,52,-28,54,1,0},
{52,-28,69,1,54,1,0},
{80,-19,71,-28,76,-27,0},
{80,-19,76,-27,79,-24,0},
{69,21,69,1,80,21,0},
{80,-19,80,21,69,1,0},
{69,1,71,-28,80,-19,0},
{71,-28,69,1,52,-28,0},
{-48,-12,-40,-12,-40,1,0},
{-48,-12,-40,4,-48,20,0},
{-40,4,-48,-12,-40,1,0},
{-40,4,-40,1,-33,2,0},
{-48,20,-40,4,-40,20,0},
{-33,2,-32,-12,-24,-12,0},
{-32,20,-40,4,-33,2,0},
{-22,20,-32,20,-33,2,0},
{-33,2,-40,1,-32,-12,0},
{-20,20,-20,-12,-13,-12,0},
{-13,-12,-13,20,-20,20,0},
{-9,20,-9,-12,-2,12,0},
{-2,12,-9,-12,-2,-12,0},
{-2,12,10,12,10,20,0},
{-2,12,10,20,-9,20,0},
{12,20,12,-12,20,12,0},
{20,12,12,-12,20,-12,0},
{20,12,32,12,32,20,0},
{20,12,32,20,12,20,0},
{55,-16,56,-16,55,-15,12},
{55,-15,56,-16,54,-14,12},
{54,-14,56,-16,54,-9,12},
{56,-16,69,-9,54,-9,12},
{67,-16,68,-16,69,-15,12},
{69,-14,69,-9,67,-16,12},
{69,-14,67,-16,69,-15,12},
{67,-16,69,-9,56,-16,12},
{86,21,86,-28,97,9,0},
{97,9,86,-28,97,-28,0},
{97,9,115,9,115,21,0},
{97,9,115,21,86,21,0},
{118,21,118,-28,129,9,0},
{129,9,118,-28,129,-28,0},
{129,9,147,9,147,21,0},
{129,9,147,21,118,21,0},
{-47,34,-47,34,-48,35,12},
{-48,35,-47,34,-48,35,12},
{-48,35,-47,34,-48,38,12},
{-47,34,-38,38,-48,38,12},
{-39,34,-39,34,-38,35,12},
{-38,35,-38,38,-39,34,12},
{-38,35,-39,34,-38,35,12},
{-39,34,-38,38,-47,34,12},
{-27,26,-20,26,-20,49,0},
{-19,50,-19,50,-27,53,0},
{-27,26,-20,49,-27,53,0},
{-27,53,-20,49,-19,50,0},
{-27,53,-19,50,-26,56,0},
{-19,50,-21,58,-24,58,0},
{-24,58,-26,56,-19,50,0},
{-21,58,-18,50,-9,58,0},
{-21,58,-19,50,-18,50,0},
{-11,50,-10,50,-3,53,0},
{-10,26,-3,26,-10,49,0},
{-10,50,-10,49,-3,53,0},
{-3,53,-10,49,-3,26,0},
{-12,50,-9,58,-18,50,0},
{-12,50,-11,50,-9,58,0},
{-6,58,-9,58,-11,50,0},
{-11,50,-4,56,-6,58,0},
{-11,50,-3,53,-4,56,0},
{17,35,8,50,8,34,12},
{8,50,17,49,15,50,12},
{16,50,15,50,17,49,12},
{17,35,8,34,15,34,12},
{16,34,17,35,17,35,12},
{17,49,17,50,16,50,12},
{8,50,17,35,17,49,12},
{15,34,16,34,17,35,12},
{28,58,28,26,35,26,0},
{35,26,35,58,28,58,0},
{86,34,87,34,86,35,12},
{86,35,87,34,86,35,12},
{86,35,87,34,86,38,12},
{87,34,94,34,86,38,12},
{94,34,95,34,95,35,12},
{96,35,96,38,94,34,12},
{96,35,94,34,95,35,12},
{94,34,96,38,86,38,12},
{107,26,114,26,114,41,0},
{107,58,114,41,114,58,0},
{114,41,107,58,107,26,0},
{114,41,124,43,120,50,0},
{114,26,119,34,114,41,0},
{124,26,132,26,124,43,0},
{124,43,132,58,125,58,0},
{132,58,124,43,132,26,0},
{120,50,124,43,125,58,0},
{114,41,119,34,124,43,0},
{151,35,143,50,143,34,12},
{143,50,151,49,150,50,12},
{151,50,150,50,151,50,12},
{151,35,143,34,150,34,12},
{151,35,151,35,150,34,12},
{151,49,151,50,150,50,12},
{143,50,151,35,151,49,12},
{151,34,151,35,150,34,12},
{-54,97,-54,65,-46,89,0},
{-46,89,-54,65,-46,65,0},
{-46,89,-35,89,-35,97,0},
{-46,89,-35,97,-54,97,0},
{-32,97,-32,65,-25,65,0},
{-25,65,-25,97,-32,97,0},
{-13,73,-13,73,-21,71,0},
{-20,67,-13,73,-21,71,0},
{-13,73,-14,74,-21,71,0},
{-13,73,-18,65,-15,65,0},
{-18,65,-13,73,-20,67,0},
{-21,71,-14,74,-14,88,0},
{-18,96,-20,95,-13,89,0},
{-21,91,-13,89,-20,95,0},
{-15,97,-18,96,-13,89,0},
{-13,88,-21,91,-14,88,0},
{-21,91,-13,88,-13,89,0},
{-21,91,-21,71,-14,88,0},
{-13,73,-15,65,-12,73,0},
{1,65,1,73,-12,73,0},
{-15,65,1,65,-12,73,0},
{-10,77,1,77,-6,84,0},
{-6,89,-15,97,-12,89,0},
{1,77,-6,89,-6,84,0},
{-6,89,1,77,1,97,0},
{1,97,-15,97,-6,89,0},
{-10,84,-10,77,-6,84,0},
{-12,89,-15,97,-13,89,0},
{5,65,12,65,12,77,0},
{5,65,12,77,12,85,0},
{5,97,12,85,12,97,0},
{12,85,5,97,5,65,0},
{12,77,21,77,12,85,0},
{21,65,29,65,21,77,0},
{21,77,29,65,21,85,0},
{21,85,29,97,21,97,0},
{29,97,21,85,29,65,0},
{21,77,21,85,12,85,0},
{31,73,31,65,39,73,0},
{39,97,39,73,46,73,0},
{31,65,46,73,39,73,0},
{46,73,53,65,53,73,0},
{53,65,46,73,31,65,0},
{46,73,46,97,39,97,0},
{56,67,58,65,64,73,0},
{64,73,56,71,56,67,0},
{64,73,58,65,61,65,0},
{64,73,64,73,61,65,0},
{63,73,63,74,56,71,0},
{56,71,63,74,56,79,0},
{64,73,63,73,56,71,0},
{61,65,78,65,64,73,0},
{56,79,63,74,63,76,0},
{56,82,56,79,63,77,0},
{56,89,70,89,56,97,0},
{63,77,64,77,58,84,0},
{64,77,62,84,58,84,0},
{62,84,64,77,64,77,0},
{62,84,64,77,70,84,0},
{63,77,58,84,56,82,0},
{56,79,63,76,63,77,0},
{70,84,73,77,71,84,0},
{70,84,64,77,73,77,0},
{76,78,71,85,71,84,0},
{71,84,73,77,76,78,0},
{78,80,79,83,71,85,0},
{78,80,71,85,76,78,0},
{78,65,78,73,64,73,0},
{71,85,79,83,72,86,0},
{70,89,71,89,73,97,0},
{71,88,78,94,71,89,0},
{79,91,78,94,71,88,0},
{72,88,72,86,79,83,0},
{76,96,73,97,71,89,0},
{71,89,78,94,76,96,0},
{72,88,79,91,71,88,0},
{79,83,79,91,72,88,0},
{70,89,73,97,56,97,0},
{82,91,83,90,83,89,0},
{83,89,84,89,82,91,0},
{82,95,82,91,90,91,0},
{83,96,82,95,84,97,0},
{84,97,83,97,83,96,0},
{84,97,82,95,88,97,0},
{90,91,82,91,84,89,0},
{88,89,89,89,90,90,0},
{90,90,90,91,88,89,0},
{90,95,82,95,90,91,0},
{89,97,88,97,90,96,0},
{90,95,90,96,88,97,0},
{82,95,90,95,88,97,0},
{90,91,84,89,88,89,0},
{82,85,82,65,90,65,0},
{90,65,90,85,82,85,0},
{94,91,94,90,94,89,0},
{94,89,95,89,94,91,0},
{94,95,94,91,101,91,0},
{94,96,94,95,95,97,0},
{95,97,94,97,94,96,0},
{95,97,94,95,99,97,0},
{101,91,94,91,95,89,0},
{99,89,100,89,101,90,0},
{101,90,101,91,99,89,0},
{101,95,94,95,101,91,0},
{100,97,99,97,101,96,0},
{101,95,101,96,99,97,0},
{94,95,101,95,99,97,0},
{101,91,95,89,99,89,0},
{94,85,94,65,101,65,0},
{101,65,101,85,94,85,0},
{105,91,105,90,106,89,0},
{106,89,106,89,105,91,0},
{105,95,105,91,112,91,0},
{105,96,105,95,106,97,0},
{106,97,105,97,105,96,0},
{106,97,105,95,110,97,0},
{112,91,105,91,106,89,0},
{110,89,111,89,112,90,0},
{112,90,112,91,110,89,0},
{112,95,105,95,112,91,0},
{111,97,110,97,112,96,0},
{112,95,112,96,110,97,0},
{105,95,112,95,110,97,0},
{112,91,106,89,110,89,0},
{105,85,105,65,112,65,0},
{112,65,112,85,105,85,0},
{116,91,116,90,117,89,0},
{117,89,118,89,116,91,0},
{116,95,116,91,123,91,0},
{116,96,116,95,117,97,0},
{117,97,117,97,116,96,0},
{117,97,116,95,122,97,0},
{123,91,116,91,118,89,0},
{122,89,123,89,123,90,0},
{123,90,123,91,122,89,0},
{123,95,116,95,123,91,0},
{123,97,122,97,123,96,0},
{123,95,123,96,122,97,0},
{116,95,123,95,122,97,0},
{123,91,118,89,122,89,0},
{116,85,116,65,123,65,0},
{123,65,123,85,116,85,0},
{127,91,127,90,128,89,0},
{128,89,129,89,127,91,0},
{127,95,127,91,134,91,0},
{127,96,127,95,129,97,0},
{129,97,128,97,127,96,0},
{129,97,127,95,133,97,0},
{134,91,127,91,129,89,0},
{133,89,134,89,134,90,0},
{134,90,134,91,133,89,0},
{134,95,127,95,134,91,0},
{134,97,133,97,134,96,0},
{134,95,134,96,133,97,0},
{127,95,134,95,133,97,0},
{134,91,129,89,133,89,0},
{127,85,127,65,134,65,0},
{134,65,134,85,127,85,0},
{138,91,138,90,139,89,0},
{139,89,140,89,138,91,0},
{138,95,138,91,146,91,0},
{138,96,138,95,140,97,0},
{140,97,139,97,138,96,0},
{140,97,138,95,144,97,0},
{146,91,138,91,140,89,0},
{144,89,145,89,145,90,0},
{145,90,146,91,144,89,0},
{146,95,138,95,146,91,0},
{145,97,144,97,145,96,0},
{146,95,145,96,144,97,0},
{138,95,146,95,144,97,0},
{146,91,140,89,144,89,0},
{138,85,138,65,146,65,0},
{146,65,146,85,138,85,0},
{149,91,149,90,151,89,0},
{150,89,151,89,149,90,0},
{149,95,149,91,157,91,0},
{149,96,149,95,151,97,0},
{151,97,150,97,149,96,0},
{151,97,149,95,155,97,0},
{157,91,149,91,151,89,0},
{155,89,156,89,156,90,0},
{156,90,157,91,155,89,0},
{157,95,149,95,157,91,0},
{156,97,155,97,156,96,0},
{157,95,156,96,155,97,0},
{149,95,157,95,155,97,0},
{157,91,151,89,155,89,0},
{149,85,149,65,157,65,0},
{157,65,157,85,149,85,0},
}

function ka_draw_tris(x,y,tris)
 for i=1,#tris do
  x1 = tris[i][1]
  y1 = tris[i][2]
  x2 = tris[i][3]
  y2 = tris[i][4]
  x3 = tris[i][5]
  y3 = tris[i][6]
  
  tri(
   x+x1,
   y+y1,
   x+x2,
   y+y2,
   x+x3,
   y+y3,
   tris[i][7]
  )
 end
end

ka_stroberpal={15,15,15,14,13,10,9,9,9,10,11,12,10,10,9,8}
function ka_strober(scx,scy,dy,kt)
local st=kt/4
local d=150
local a2=math.pi/2
local n=6000

for i=1,n do
    local kk=i//(n/3)
    local a1=st+kk*math.pi*2/3
    local ar=math.random()*math.pi*2
    local Z=d*(math.random())
    local dd=25
    local X=d*math.sin(a1)+dd*math.sin(ar)
    local Y=d*math.cos(a2)+dd*math.cos(ar)
    local z=Z*math.cos(a1) /99
    local x=X*z
    local y=Y*z*dy
    if z>-0.05 then
        local cl=pix(scx+x,scy+y)
        cl=ka_stroberpal[cl+1]
        pix(scx+x,scy+y,cl)
    end
end

end

function ka_siren(fr,kt)
    for i=0,31 do poke4(2*65438+i,(math.sin(i/8 * math.pi*2)+1)*2) end -- setup waveform
    frequency = (128+128*math.sin(kt*2))*fr
    poke(65436+0,math.min(255,frequency)) 
    poke(65437+0,((2*fr)//1)%16+((0xf*fr)//1<<4))
end

function ka_penguin(cx,cy,dy,bounce)
-- body, black
elli(cx,cy+10*dy,12,20*dy,0)
elli(cx,cy+10*dy,12,10*dy,0)
elli(cx,cy+12*dy,13,10*dy,0)
elli(cx,cy+15*dy,14,10*dy,0)
elli(cx,cy+20*dy,15,10*dy,0)

-- arms
tri(cx-30,cy+(4+bounce*2)*dy,cx-5,cy+4*dy,cx-5,cy-3*dy,0)
tri(cx+30,cy+(4+bounce*2)*dy,cx+5,cy+4*dy,cx+5,cy-3*dy,0)


-- head
elli(cx,cy-10*dy,9,15*dy,0)
elli(cx-4,cy-12*dy,3,4*dy,12)
elli(cx-4,cy-11*dy,2,3*dy,0)
elli(cx+4,cy-12*dy,3,4*dy,12)
elli(cx+4,cy-11*dy,2,3*dy,0)

--hat
rect(cx-9,cy-18*dy,19,2*dy,0)
rect(cx-8,cy-34*dy,17,16*dy,8)
elli(cx,cy-34*dy,7,7*dy,8)

-- body, white
elli(cx,cy+10*dy,10,18*dy,12)
elli(cx,cy+10*dy,10,9*dy,13)
elli(cx,cy+12*dy,11,9*dy,13)
elli(cx,cy+15*dy,12,9*dy,13)
elli(cx,cy+20*dy,13,8*dy,13)

--feet
rect(cx-21,cy+15*dy,4,15*dy,4)
tri(cx-25,cy+15*dy,cx-21,cy+15*dy,cx-21,cy+30*dy,4)
tri(cx-17,cy+15*dy,cx-13,cy+15*dy,cx-17,cy+30*dy,4)

rect(cx+17,cy+15*dy,4,15*dy,4)
tri(cx+25,cy+15*dy,cx+21,cy+15*dy,cx+21,cy+30*dy,4)
tri(cx+17,cy+15*dy,cx+13,cy+15*dy,cx+17,cy+30*dy,4)

--beak
tri(cx,cy-10*dy,cx,cy-3*dy,cx-6,cy-6*dy,3)
tri(cx,cy-10*dy,cx,cy-3*dy,cx+6,cy-6*dy,4)
end

kaaal_st=0
function kaaal_init()
    kaaal_st=_t
	sweetie16_init()
	salad(1,{amiga},2000,1000)
	salad(4,{banana},4000,2000)
end


function kaaal()
	local t=(_t-kaaal_st)/100
	local cx=120
	local cy=98-5*math.sin(t*2)
	local dy=1
	local ty=-300

	local textstarttime = 40

	if t > textstarttime then
	 dy = 1 - math.min(0.9,(t-textstarttime)/2)
	 cy=math.min(130,98+(t-textstarttime)*15)
	 ty=math.min(-100+((t-textstarttime)*40)//1,-5)
	 ka_siren(math.max(0,1-(t-textstarttime)/2),t)
	else
	 cy=98-5*math.sin(t*2)
	 bounce = math.sin(t)
	 ka_siren(1,t)
	end

	cls(12)

	rect(0,114,240,22,14)

	ka_penguin(cx,cy,dy,bounce)

	ka_strober(cx,cy-30*dy,dy,t)

	ka_draw_tris(65,35+ty,kaaalt)

	overlay_defaults((_t-kaaal_st),"75","KILL")
end
