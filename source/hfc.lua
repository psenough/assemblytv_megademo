hfc_hot=
{
{20,5,20,5,20,20,17,27,10,32,0,34,-8,32,-15,27,-18,20,-19,-5,-19,-5,-18,-19,-15,-27,-9,-32,0,-34,10,-32,16,-27,20,-19},
{-25,-32,-25,33,-42,33,-42,5,-48,5,-48,33,-65,33,-65,-32,-48,-32,-48,-9,-42,-9,-42,-32},
{3,-15,2,-21,0,-23,-1,-22,-2,-15,-2,15,-1,22,0,23,2,21,3,14,3,-15},
{61,-32,61,-19,51,-19,51,33,34,33,34,-19,23,-19,23,-32},
}

hfc_fantasy=
{
{-123,-29,-97,-29,-97,-17,-108,-17,-108,-6,-98,-6,-98,4,-108,4,-108,29,-123,29},
{-77,8,-77,8,-79,-16,-79,-16,-82,8},
{-68,-29,-60,29,-75,29,-76,18,-82,18,-82,29,-98,29,-91,-29},
{-23,-29,-23,29,-36,29,-44,2,-44,29,-57,29,-57,-29,-44,-29,-36,-2,-36,-29},
{13,-29,13,-17,4,-17,4,29,-10,29,-10,-17,-19,-17,-19,-29},
{32,8,32,8,30,-16,30,-16,27,8},
{40,-29,49,29,33,29,33,18,27,18,26,29,10,29,18,-29},
{84,-11,70,-11,70,-16,70,-16,70,-19,70,-19,68,-20,68,-20,66,-19,66,-19,65,-16,65,-16,66,-11,66,-11,70,-8,70,-8,83,1,83,1,86,14,86,14,84,23,84,23,78,28,78,28,69,30,69,30,58,28,58,28,52,22,52,22,51,12,51,8,65,8,65,15,65,15,66,19,66,19,68,20,68,20,70,19,70,19,71,15,71,15,70,9,70,9,62,3,62,3,55,-1,55,-1,52,-6,52,-6,51,-14,51,-14,52,-24,52,-24,58,-28,58,-28,67,-30,67,-30,77,-28,77,-28,83,-23,83,-23,84,-13},
{123,-29,112,8,112,29,98,29,98,8,87,-29,101,-29,101,-29,105,-6,105,-6,109,-29},
}

hfc_consoles=
{
{-111,-3,-126,-3,-126,-13,-126,-13,-127,-19,-129,-20,-131,-19,-132,13,-132,13,-131,19,-129,20,-127,19,-126,6,-111,6,-111,8,-111,8,-112,21,-118,28,-129,30,-140,28,-146,21,-147,-8,-147,-8,-147,-18,-144,-24,-138,-28,-129,-30,-118,-27,-112,-21},
{-86,-14,-86,-14,-86,-19,-88,-20,-90,-19,-91,13,-91,13,-90,19,-88,20,-86,19},
{-70,5,-70,5,-71,17,-73,24,-79,29,-88,30,-97,29,-103,24,-105,17,-106,-4,-106,-4,-105,-17,-103,-24,-97,-28,-88,-30,-80,-29,-74,-24,-71,-17},
{-30,-29,-30,29,-44,29,-52,2,-52,29,-65,29,-65,-29,-52,-29,-43,-2,-43,-29},
{7,-11,-6,-11,-6,-15,-6,-15,-6,-19,-8,-20,-10,-19,-11,-16,-10,-11,-6,-8,6,1,9,14,7,23,1,28,-7,30,-18,28,-24,22,-25,8,-11,8,-11,15,-11,15,-10,19,-8,20,-6,19,-5,16,-6,9,-14,3,-21,-1,-24,-6,-25,-14,-24,-23,-18,-28,-9,-30,0,-28,6,-23},
{33,-14,33,-14,33,-19,31,-20,29,-19,28,13,28,13,29,19,31,20,33,19},
{48,5,48,5,48,17,45,24,39,29,31,30,22,29,16,24,13,17,13,-4,13,-4,13,-17,16,-24,22,-28,31,-30,39,-29,45,-24,48,-17},
{70,-29,70,17,79,17,79,29,54,29,54,-29},
{83,-29,108,-29,108,-17,98,-17,98,-6,108,-6,108,4,98,4,98,17,109,17,109,29,83,29},
{146,-11,132,-11,132,-15,132,-15,131,-19,130,-20,127,-19,127,-16,128,-11,132,-8,145,1,147,14,146,23,140,28,130,30,120,28,114,22,113,8,127,8,127,15,127,15,128,19,130,20,132,19,133,16,131,9,124,3,117,-1,114,-6,112,-14,114,-23,120,-28,129,-30,139,-28,145,-23},
}

local hfc_pal={0,8,9}

function hfc_draw_polylines(xo,yo,t,polylines,scale,angle)
    angle=angle or 0
    scale=scale or 1
    local m_c_a = math.cos(angle)
    local m_s_a = math.sin(angle)
    local lines = {}
    for _, polyline in pairs(polylines) do
        for i = 1, #polyline - 2, 2 do
            local x1 = polyline[i]*scale
            local y1 = polyline[i + 1]*scale
            local x2 = polyline[i + 2]*scale
            local y2 = polyline[i + 3]*scale
            local p1 = {x=x1,y=y1}
            local p2 = {x=x2,y=y2}

            local xt = p1.x*m_c_a - p1.y*m_s_a
            local yt = p1.x*m_s_a + p1.y*m_c_a
            local zt = p1.z

            p1.x,p1.y,p1.z=xt,yt,zt

            local xt = p2.x*m_c_a - p2.y*m_s_a
            local yt = p2.x*m_s_a + p2.y*m_c_a
            local zt = p2.z

            p2.x,p2.y,p2.z=xt,yt,zt

            table.insert(lines,{p1,p2})
        end
        p1={x=polyline[1]*scale,y=polyline[2]*scale}
        p2={x=polyline[#polyline - 1]*scale, y= polyline[#polyline]*scale}

        local xt = p1.x*m_c_a - p1.y*m_s_a
        local yt = p1.x*m_s_a + p1.y*m_c_a
        local zt = p1.z

        p1.x,p1.y,p1.z=xt,yt,zt

        local xt = p2.x*m_c_a - p2.y*m_s_a
        local yt = p2.x*m_s_a + p2.y*m_c_a
        local zt = p2.z

        p2.x,p2.y,p2.z=xt,yt,zt

        table.insert(lines,{p1,p2})
    end

    for j=1,4 do
        local x=122+math.sin(j+t*10+xo)
        local y=yo+j*2
        for i=1,#lines do
            local p1=lines[i][1]
            local p2=lines[i][2]
            line(x+p1.x,y+p1.y, x+p2.x, y+p2.y, j)
        end
    end
end

hfc_st = 0
hfc_uvs = {}
function hfc_init()
	hfc_st = _t
	sweetie16_init()
	salad(1,{peach},2000,2000)
	salad(2,{banana},3000,2000)
	salad(4,{kiwi,fig,apple,pear},3000,1000)

 for i=0,32639 do
  local x=i%240-120
  local y=i/240-68
  local u=math.atan2(y,x)*7.17
  local v=200/(x*x+y*y)^.5
  hfc_uvs[i+1]=u+v
 end
end

function hfc()
 local t=(_t-hfc_st)/800
 for i=0,32639 do
    poke4(i,hfc_pal[((hfc_uvs[i+1]+t)%3)//1+ 1])
 end

 local scale = 0

 if t > 0 then
  scale = math.min(t,0.5)
  hfc_draw_polylines(20,20,t,hfc_hot,scale,scale*12.4)
 end

 if t > 1 then
  scale = math.min(t-1,0.5)
  hfc_draw_polylines(60,55,t,hfc_fantasy,scale,scale*12.8)
 end

 if t > 2 then
  scale = math.min(t-2,0.5)
  hfc_draw_polylines(98,92,t,hfc_consoles,scale,scale*12.4)
 end

 rect(0,128,240,10,2)
 print("Call your provider to unlock for just $9.99! Experience peek() nostalgia! 16 colors - 4 channel audio - 240x136 resolution!",20-(_t-hfc_st)/15,129,12)

 overlay_defaults((_t - hfc_st), "69", "HOT")
end
